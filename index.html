<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üç† UbeStudy - Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root { --ube:#957DAD; --dark:#4A148C; --bg:#F8F9FE; }
* { box-sizing:border-box; font-family:'Nunito', sans-serif; }
body { background:var(--bg); margin:0; min-height:100vh; display:flex; justify-content:center; align-items:flex-start; padding-top:30px; }

/* Common view */
.view { display:none; width:100%; max-width:400px; padding:20px; text-align:center; }
.view.active { display:flex; flex-direction:column; align-items:center; }
.card { background:white; padding:30px; border-radius:25px; box-shadow:0 10px 30px rgba(0,0,0,0.05); width:100%; }
input { width:100%; padding:14px; margin:10px 0; border-radius:12px; border:2px solid #eee; font-size:15px; outline:none; }
button { width:100%; padding:15px; border:none; border-radius:12px; font-weight:800; cursor:pointer; margin-top:15px; background:var(--ube); color:white; transition:.3s; }
button:hover { background:var(--dark); }
.switch { margin-top:15px; font-size:14px; cursor:pointer; color:var(--dark); font-weight:700; }
#status { margin-top:15px; font-weight:bold; font-size:14px; }

/* Profile */
#user-avatar { border-radius:50%; width:80px; height:80px; object-fit:cover; margin-bottom:10px; }
#user-name { margin:0; margin-bottom:15px; }

/* Subjects */
.subject-card { background:#f5f5f5; margin:10px 0; padding:12px 10px; border-radius:12px; cursor:pointer; position:relative; }
.subject-card:hover .tooltip { display:block; }
.tooltip { display:none; position:absolute; top:100%; left:50%; transform:translateX(-50%); background:#fff; padding:8px; border-radius:8px; box-shadow:0 5px 20px rgba(0,0,0,0.1); width:250px; z-index:10; font-size:13px; text-align:left; }

/* Level */
.level { margin:10px 0; font-weight:600; }
</style>
</head>
<body>

<!-- Auth View -->
<div id="view-auth" class="view active">
    <div class="card">
        <h1 style="color:var(--dark)">üç† UbeStudy</h1>
        <h3 id="formTitle">Sign Up</h3>
        <input type="text" id="name" placeholder="Full Name">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="authBtn">Create Account</button>
        <div class="switch" id="toggleMode">Already have an account? Login</div>
        <div id="status"></div>
    </div>
</div>

<!-- Home View -->
<div id="view-home" class="view">
    <img id="user-avatar" src="https://i.pravatar.cc/100?u=default" alt="Profile">
    <h2 id="user-name">Ube Student</h2>
    <div class="level" id="user-level">Level: üå± Seedling (0)</div>
    <div class="card">
        <h3>Select Subject</h3>
        <div class="subject-card" data-subject="Crop Science">
            Crop Science
            <div class="tooltip">Covers principles of agronomy, field crops, horticulture, physiology, and plant breeding.</div>
        </div>
        <div class="subject-card" data-subject="Soil Science">
            Soil Science
            <div class="tooltip">Focuses on soil management, fertility, and conservation.</div>
        </div>
        <div class="subject-card" data-subject="Crop Protection">
            Crop Protection
            <div class="tooltip">Covers plant pests, diseases, and management.</div>
        </div>
        <div class="subject-card" data-subject="Animal Science">
            Animal Science
            <div class="tooltip">Involves livestock production and management.</div>
        </div>
        <div class="subject-card" data-subject="Agri Economics">
            Agricultural Economics
            <div class="tooltip">Focuses on agribusiness and marketing principles.</div>
        </div>
        <div class="subject-card" data-subject="Agri Extension">
            Agricultural Extension
            <div class="tooltip">Covers communication strategies for agricultural development.</div>
        </div>
        <button style="background:#ddd; color:#666; margin-top:20px;" onclick="app.logout()">Logout</button>
    </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

// --- CONFIGURATION ---
const SUPABASE_URL = "https://tbftpvkydneckzdpfdev.supabase.co";
const SUPABASE_KEY = "PASTE_YOUR_LONG_EYJ_KEY_HERE"; // Replace with your Supabase long API key
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// --- APP STATE ---
window.app = {
    isLogin: false,
    user: null,
    levelPoints: 0,

    showView(id){
        document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    },

    async handleAuth(){
        const email=document.getElementById("email").value;
        const password=document.getElementById("password").value;
        const name=document.getElementById("name").value;
        const status=document.getElementById("status");
        status.style.color="blue"; status.innerText="Processing...";

        try {
            let res;
            if(this.isLogin){
                res=await supabase.auth.signInWithPassword({email,password});
            } else {
                res=await supabase.auth.signUp({email,password,options:{data:{full_name:name}}});
            }
            if(res.error) throw res.error;

            if(this.isLogin) this.checkUser();
            else { status.style.color="green"; status.innerText="Signup successful! Please login."; }
        } catch(err){
            status.style.color="red"; status.innerText=err.message;
        }
    },

    async checkUser(){
        const {data:{user}} = await supabase.auth.getUser();
        if(user){
            this.user=user;
            document.getElementById("user-name").innerText = user.user_metadata?.full_name || "Ube Student";
            document.getElementById("user-avatar").src = `https://i.pravatar.cc/100?u=${user.id || 'default'}`;
            this.updateLevel();
            this.showView('view-home');
        }
    },

    logout(){ supabase.auth.signOut(); location.reload(); },

    updateLevel(){
        const points=this.levelPoints;
        let level=1, emoji='üå±', title='Seedling';
        if(points>=50){ level=50; emoji='üëë'; title='Secretary of Agriculture'; }
        else if(points>=21){ level=21; emoji='üåæ'; title='Agronomist'; }
        else if(points>=11){ level=11; emoji='üöú'; title='Field Manager'; }
        else if(points>=6){ level=6; emoji='üë®‚Äçüåæ'; title='Backyard Gardener'; }
        document.getElementById("user-level").innerText = `Level ${level}: ${emoji} ${title} (${points})`;
    },

    showSubjects(){
        document.querySelectorAll('.subject-card').forEach(card=>{
            card.onclick=()=>alert(`Selected: ${card.dataset.subject}\n(Mode and Ranking can be implemented here)`); 
        });
    }
};

// --- BUTTON LISTENERS ---
document.getElementById("authBtn").onclick = ()=>app.handleAuth();
document.getElementById("toggleMode").onclick = ()=>{
    app.isLogin = !app.isLogin;
    document.getElementById("formTitle").innerText = app.isLogin?"Login":"Sign Up";
    document.getElementById("authBtn").innerText = app.isLogin?"Login":"Create Account";
    document.getElementById("name").style.display = app.isLogin?"none":"block";
    document.getElementById("toggleMode").innerText = app.isLogin?"Don't have an account? Sign Up":"Already have an account? Login";
};

app.checkUser();
</script>
</body>
</html>
