<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üç† UbeStudy Auth</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">

<style>
:root { --ube:#957DAD; --dark:#4A148C; --bg:#F8F9FE; }
* { box-sizing:border-box; font-family:'Nunito', sans-serif; }
body {
    background:var(--bg);
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    margin:0;
}
.card {
    background:white;
    padding:40px;
    border-radius:25px;
    box-shadow:0 10px 30px rgba(0,0,0,0.05);
    width:100%;
    max-width:380px;
    text-align:center;
}
input {
    width:100%;
    padding:14px;
    margin:10px 0;
    border-radius:12px;
    border:2px solid #eee;
    font-size:15px;
}
button {
    width:100%;
    padding:15px;
    border:none;
    border-radius:12px;
    font-weight:800;
    cursor:pointer;
    margin-top:15px;
    background:var(--ube);
    color:white;
}
button:hover { background:var(--dark); }
.switch {
    margin-top:15px;
    font-size:14px;
    cursor:pointer;
    color:var(--dark);
}
#status { margin-top:15px; font-weight:bold; font-size:14px; }
.hidden { display:none; }
</style>
</head>
<body>

<div class="card">
    <h1 style="color:var(--dark)">üç† UbeStudy</h1>
    <h3 id="formTitle">Sign Up</h3>

    <input type="text" id="name" placeholder="Full Name">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">

    <button id="authBtn">Create Account</button>

    <div class="switch" id="toggleMode">
        Already have an account? Login
    </div>

    <div id="status"></div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

/* ‚úÖ Correct Supabase Config */
const SUPABASE_URL = "https://tbftpvkydneckzdpfdev.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRiZnRwdmt5ZWNrzdHBmZGV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNDQxMDIsImV4cCI6MjA4NjYyMDEwMn0.21_APgXQVIeVSuHsNMqa55UGNFOEdDUYvNaUI1_XkY4";

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

let isLogin = false;

const nameInput = document.getElementById("name");
const emailInput = document.getElementById("email");
const passInput = document.getElementById("password");
const authBtn = document.getElementById("authBtn");
const toggle = document.getElementById("toggleMode");
const statusDiv = document.getElementById("status");
const title = document.getElementById("formTitle");

/* Toggle Login / Signup */
toggle.addEventListener("click", () => {
    isLogin = !isLogin;

    if (isLogin) {
        title.innerText = "Login";
        authBtn.innerText = "Login";
        nameInput.classList.add("hidden");
        toggle.innerText = "Don't have an account? Sign Up";
    } else {
        title.innerText = "Sign Up";
        authBtn.innerText = "Create Account";
        nameInput.classList.remove("hidden");
        toggle.innerText = "Already have an account? Login";
    }

    statusDiv.innerText = "";
});

/* Auth Action */
authBtn.addEventListener("click", async () => {

    const email = emailInput.value.trim();
    const password = passInput.value.trim();
    const name = nameInput.value.trim();

    if (!email || !password) {
        statusDiv.style.color = "red";
        statusDiv.innerText = "Please fill all required fields.";
        return;
    }

    statusDiv.style.color = "blue";
    statusDiv.innerText = "Processing...";

    try {
        let response;

        if (isLogin) {
            response = await supabase.auth.signInWithPassword({ email, password });
        } else {
            if (!name) {
                statusDiv.style.color = "red";
                statusDiv.innerText = "Full name required.";
                return;
            }
            response = await supabase.auth.signUp({
                email,
                password,
                options: { data: { full_name: name } }
            });
        }

        if (response.error) throw response.error;

        statusDiv.style.color = "green";
        statusDiv.innerText = isLogin
            ? "Login successful üéâ"
            : "Signup successful! Check your email.";

        console.log("Auth Success:", response.data);

    } catch (err) {
        statusDiv.style.color = "red";
        statusDiv.innerText = err.message;
        console.error("Auth Error:", err);
    }
});
</script>

</body>
</html>
